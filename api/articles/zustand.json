{"title":"zustand","uid":"95e1d6877ea327ec4515e34d7f460889","slug":"zustand","date":"2023-11-25T17:37:41.000Z","updated":"2023-11-27T17:38:22.215Z","comments":true,"path":"api/articles/zustand.json","keywords":null,"cover":null,"content":"<h2 id=\"为什么要使用-zustand\"><a href=\"#为什么要使用-zustand\" class=\"headerlink\" title=\"为什么要使用 zustand\"></a>为什么要使用 zustand</h2><ol>\n<li>写法比较简便，你甚至不需要根组件外面包裹一层东西，足够轻量（核心代码只有 1kb）。</li>\n<li>写法大部分（<del>小部分写法我感觉也很逆天</del>）比较符合我的审美（仅仅是我的审美），不需要结合上下文，纯 hook 式调用。</li>\n<li>写法更接近于 redux，虽然我很讨厌 redux 繁琐的写饭，但不不得不承认，今后进入公司一些老项目大概率会是用的 redux，熟悉类似 redux 写法的话，有利于上手。</li>\n<li>在新兴的状态管理库中，热度基本排在数一数二的位置，github 上目前已有 37k 的 star，谈热度并不是让大家去盲目的跟风，庞大的社区可以给为使用者提供解决问题的成熟方案，和各种各样的中间件来扩展功能。</li>\n</ol>\n<h2 id=\"初始化一个简单-store\"><a href=\"#初始化一个简单-store\" class=\"headerlink\" title=\"初始化一个简单 store\"></a>初始化一个简单 store</h2><div class=\"language-javascript\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">javascript</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">import</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#123;</span><span style=\"color: #F07178\"> </span><span style=\"color: #BABED8\">create</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">&#125;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF; font-style: italic\">from</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">zustand</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #C792EA\">interface</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">IStu</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">  </span><span style=\"color: #F07178\">number</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">number</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">  </span><span style=\"color: #F07178\">add</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">()</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C792EA\">=&gt;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">void</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">  </span><span style=\"color: #F07178\">sub</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">()</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C792EA\">=&gt;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">void</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">  </span><span style=\"color: #F07178\">remove</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">()</span><span style=\"color: #C792EA\">=&gt;</span><span style=\"color: #FFCB6B\">void</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">&#125;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #C792EA\">const</span><span style=\"color: #BABED8\"> store </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">create</span><span style=\"color: #89DDFF\">&lt;</span><span style=\"color: #FFCB6B\">IStu</span><span style=\"color: #89DDFF\">&gt;</span><span style=\"color: #BABED8\">()(</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8; font-style: italic\">set</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #BABED8; font-style: italic\">get</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C792EA\">=&gt;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">  </span><span style=\"color: #89DDFF; font-style: italic\">return</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    number</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #F07178\"> </span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">,</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    </span><span style=\"color: #82AAFF\">add</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">()</span><span style=\"color: #F07178\"> </span><span style=\"color: #C792EA\">=&gt;</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">      </span><span style=\"color: #82AAFF\">set</span><span style=\"color: #F07178\">(</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8; font-style: italic\">state</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #F07178\"> </span><span style=\"color: #C792EA\">=&gt;</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">        </span><span style=\"color: #89DDFF; font-style: italic\">return</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">          number</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">++</span><span style=\"color: #BABED8\">state</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">number</span><span style=\"color: #89DDFF\">,</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">        </span><span style=\"color: #89DDFF\">&#125;;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">      </span><span style=\"color: #89DDFF\">&#125;</span><span style=\"color: #F07178\">)</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    </span><span style=\"color: #89DDFF\">&#125;,</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    </span><span style=\"color: #82AAFF\">sub</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">()</span><span style=\"color: #F07178\"> </span><span style=\"color: #C792EA\">=&gt;</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">      </span><span style=\"color: #82AAFF\">set</span><span style=\"color: #F07178\">(</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8; font-style: italic\">state</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #F07178\"> </span><span style=\"color: #C792EA\">=&gt;</span><span style=\"color: #F07178\"> (</span><span style=\"color: #89DDFF\">&#123;</span><span style=\"color: #F07178\"> number</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">--</span><span style=\"color: #BABED8\">state</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">number</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">&#125;</span><span style=\"color: #F07178\">))</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    </span><span style=\"color: #89DDFF\">&#125;,</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    </span><span style=\"color: #82AAFF\">remove</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">()</span><span style=\"color: #F07178\"> </span><span style=\"color: #C792EA\">=&gt;</span><span style=\"color: #F07178\"> </span><span style=\"color: #82AAFF\">set</span><span style=\"color: #F07178\">(</span><span style=\"color: #89DDFF\">&#123;</span><span style=\"color: #F07178\"> number</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #F07178\"> </span><span style=\"color: #F78C6C\">0</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">&#125;</span><span style=\"color: #F07178\">)</span><span style=\"color: #89DDFF\">,</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    </span><span style=\"color: #82AAFF\">otherAdd</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">()</span><span style=\"color: #F07178\"> </span><span style=\"color: #C792EA\">=&gt;</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">      </span><span style=\"color: #82AAFF\">set</span><span style=\"color: #F07178\">(</span><span style=\"color: #89DDFF\">&#123;</span><span style=\"color: #F07178\"> number</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">++</span><span style=\"color: #82AAFF\">get</span><span style=\"color: #F07178\">()</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">number</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">&#125;</span><span style=\"color: #F07178\">)</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    </span><span style=\"color: #89DDFF\">&#125;,</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">  </span><span style=\"color: #89DDFF\">&#125;;</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">&#125;</span><span style=\"color: #BABED8\">)</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">export</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF; font-style: italic\">default</span><span style=\"color: #BABED8\"> useStudentsStore</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"></span></code></pre></div><p>几个要注意的点：</p>\n<ol>\n<li>使用 ts 的话一定，要写类型声明不然会报错。</li>\n<li>范式声明后面要加括号，至于为什么我没太看懂（大概是跟柯里化相关），有兴趣可以看下<a href=\"https://github.com/microsoft/TypeScript/issues/10571\">这篇文章</a>。</li>\n<li>看清楚 create 里的结构:</li>\n</ol>\n<div class=\"language-javascript\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">javascript</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #82AAFF\">create</span><span style=\"color: #BABED8\">(</span><span style=\"color: #89DDFF\">()</span><span style=\"color: #C792EA\">=&gt;</span><span style=\"color: #89DDFF\">&#123;</span><span style=\"color: #F07178\"> </span><span style=\"color: #676E95; font-style: italic\">//create中传入的是一个函数，函数接收一系列方法，之后会提到</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">  </span><span style=\"color: #89DDFF; font-style: italic\">return</span><span style=\"color: #89DDFF\">&#123;</span><span style=\"color: #F07178\">  </span><span style=\"color: #676E95; font-style: italic\">//函数返回的是一个对象，对象中包含储存的值和修改值的方法。</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    </span><span style=\"color: #89DDFF\">...</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">  </span><span style=\"color: #89DDFF\">&#125;</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">&#125;</span><span style=\"color: #BABED8\">)</span></span></code></pre></div><h2 id=\"消费-store\"><a href=\"#消费-store\" class=\"headerlink\" title=\"消费 store\"></a>消费 store</h2><div class=\"language-javascript\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">javascript</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #C792EA\">const</span><span style=\"color: #BABED8\"> number </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">useStudentsStore</span><span style=\"color: #BABED8\">(</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8; font-style: italic\">state</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C792EA\">=&gt;</span><span style=\"color: #BABED8\"> state</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">number)</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #C792EA\">const</span><span style=\"color: #BABED8\"> add </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">useStudentsStore</span><span style=\"color: #BABED8\">(</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8; font-style: italic\">state</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C792EA\">=&gt;</span><span style=\"color: #BABED8\"> state</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">add)</span><span style=\"color: #89DDFF\">;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #676E95; font-style: italic\">//最基本的使用方式</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #C792EA\">const</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#123;</span><span style=\"color: #BABED8\"> number</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> add</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> sub</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> remove </span><span style=\"color: #89DDFF\">&#125;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">useStudentsStore</span><span style=\"color: #BABED8\">()</span><span style=\"color: #89DDFF\">;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #676E95; font-style: italic\">//仅使用于需要全部全部状态和方法，可能会引起不必要的渲染</span></span></code></pre></div><p>如果需要使用多个状态或值的话声明会很麻烦，所以作者写了一个 util，我们使用时只需要复制粘贴这段代码即可,<a href=\"https://docs.pmnd.rs/zustand/guides/auto-generating-selectors\">愿文章</a></p>\n<div class=\"language-javascript\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">javascript</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">import</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#123;</span><span style=\"color: #F07178\"> </span><span style=\"color: #BABED8\">StoreApi</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #F07178\"> </span><span style=\"color: #BABED8\">UseBoundStore</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">&#125;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF; font-style: italic\">from</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">zustand</span><span style=\"color: #89DDFF\">&#39;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #C792EA\">type</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">WithSelectors</span><span style=\"color: #89DDFF\">&lt;</span><span style=\"color: #FFCB6B\">S</span><span style=\"color: #89DDFF\">&gt;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">S</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C792EA\">extends</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#123;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F07178\">getState</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">()</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C792EA\">=&gt;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">infer</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">T</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#125;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">  </span><span style=\"color: #89DDFF\">?</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">S</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&amp;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#123;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F07178\">use</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#123;</span><span style=\"color: #BABED8\"> [</span><span style=\"color: #FFCB6B\">K</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">in</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">keyof</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">T</span><span style=\"color: #BABED8\">]</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">()</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C792EA\">=&gt;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">T</span><span style=\"color: #BABED8\">[</span><span style=\"color: #FFCB6B\">K</span><span style=\"color: #BABED8\">] </span><span style=\"color: #89DDFF\">&#125;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#125;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">  </span><span style=\"color: #89DDFF\">:</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">never</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">export</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C792EA\">const</span><span style=\"color: #BABED8\"> createSelectors </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&lt;</span><span style=\"color: #FFCB6B\">S</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C792EA\">extends</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">UseBoundStore</span><span style=\"color: #89DDFF\">&lt;</span><span style=\"color: #FFCB6B\">StoreApi</span><span style=\"color: #89DDFF\">&lt;</span><span style=\"color: #FFCB6B\">object</span><span style=\"color: #89DDFF\">&gt;&gt;&gt;(</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">  </span><span style=\"color: #BABED8; font-style: italic\">_store</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">S</span><span style=\"color: #89DDFF\">,</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C792EA\">=&gt;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">  </span><span style=\"color: #C792EA\">const</span><span style=\"color: #F07178\"> </span><span style=\"color: #BABED8\">store</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #F07178\"> </span><span style=\"color: #BABED8\">_store</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF; font-style: italic\">as</span><span style=\"color: #F07178\"> </span><span style=\"color: #FFCB6B\">WithSelectors</span><span style=\"color: #89DDFF\">&lt;typeof</span><span style=\"color: #F07178\"> </span><span style=\"color: #BABED8\">_store</span><span style=\"color: #89DDFF\">&gt;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">  </span><span style=\"color: #BABED8\">store</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">use</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">&#123;&#125;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">  </span><span style=\"color: #89DDFF; font-style: italic\">for</span><span style=\"color: #F07178\"> (</span><span style=\"color: #C792EA\">const</span><span style=\"color: #F07178\"> </span><span style=\"color: #BABED8\">k</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">of</span><span style=\"color: #F07178\"> </span><span style=\"color: #BABED8\">Object</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">keys</span><span style=\"color: #F07178\">(</span><span style=\"color: #BABED8\">store</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">getState</span><span style=\"color: #F07178\">())) </span><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">    </span><span style=\"color: #676E95; font-style: italic\">// eslint-disable-next-line @typescript-eslint/no-explicit-any</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    (</span><span style=\"color: #BABED8\">store</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">use</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF; font-style: italic\">as</span><span style=\"color: #F07178\"> </span><span style=\"color: #FFCB6B\">any</span><span style=\"color: #F07178\">)[</span><span style=\"color: #BABED8\">k</span><span style=\"color: #F07178\">] </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">()</span><span style=\"color: #F07178\"> </span><span style=\"color: #C792EA\">=&gt;</span><span style=\"color: #F07178\"> </span><span style=\"color: #82AAFF\">store</span><span style=\"color: #F07178\">(</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8; font-style: italic\">s</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #F07178\"> </span><span style=\"color: #C792EA\">=&gt;</span><span style=\"color: #F07178\"> </span><span style=\"color: #BABED8\">s</span><span style=\"color: #F07178\">[</span><span style=\"color: #BABED8\">k</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF; font-style: italic\">as</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">keyof</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">typeof</span><span style=\"color: #F07178\"> </span><span style=\"color: #BABED8\">s</span><span style=\"color: #F07178\">])</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">  </span><span style=\"color: #89DDFF\">&#125;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #F07178\">  </span><span style=\"color: #89DDFF; font-style: italic\">return</span><span style=\"color: #F07178\"> </span><span style=\"color: #BABED8\">store</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">&#125;</span></span></code></pre></div><div class=\"language-javascript\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">javascript</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #676E95; font-style: italic\">//store中用createSelectors包住store</span></span>\n<span class=\"line\"><span style=\"color: #C792EA\">const</span><span style=\"color: #BABED8\"> useStudentsStore </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">createSelectors</span><span style=\"color: #BABED8\">(store)</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\">//在组件中用use的方式引入</span></span>\n<span class=\"line\"><span style=\"color: #C792EA\">const</span><span style=\"color: #BABED8\"> add </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> useStudentsStore</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">use</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">add</span><span style=\"color: #BABED8\">()</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #C792EA\">const</span><span style=\"color: #BABED8\"> sub </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> useStudentsStore</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">use</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">sub</span><span style=\"color: #BABED8\">()</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #C792EA\">const</span><span style=\"color: #BABED8\"> remove </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> useStudentsStore</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">use</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">remove</span><span style=\"color: #BABED8\">()</span><span style=\"color: #89DDFF\">;</span></span></code></pre></div><p>其实就算使用 selectors 的方式引入还是会有点麻烦.</p>\n<h3 id=\"useshallow\"><a href=\"#useshallow\" class=\"headerlink\" title=\"useshallow\"></a>useshallow</h3><p>useShallow 是 zustand 中内置的一个 hook，使用 useShallow 为我们消费 store 提供了另一种方法。</p>\n<div class=\"language-javascript\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">javascript</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #C792EA\">const</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#123;</span><span style=\"color: #BABED8\"> add1 </span><span style=\"color: #89DDFF\">&#125;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">useShallowStore</span><span style=\"color: #BABED8\">(</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">  </span><span style=\"color: #82AAFF\">useShallow</span><span style=\"color: #BABED8\">(</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8; font-style: italic\">state</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C792EA\">=&gt;</span><span style=\"color: #BABED8\"> (</span><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #F07178\">add1</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #BABED8\"> state</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">add1</span><span style=\"color: #89DDFF\">,</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">  </span><span style=\"color: #89DDFF\">&#125;</span><span style=\"color: #BABED8\">))</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">)</span><span style=\"color: #89DDFF\">;</span></span></code></pre></div><p>这种写法可以避免组件的无意义刷新，简化了消费 store 的代码</p>\n<h2 id=\"中间件\"><a href=\"#中间件\" class=\"headerlink\" title=\"中间件\"></a>中间件</h2><h3 id=\"devtools\"><a href=\"#devtools\" class=\"headerlink\" title=\"devtools\"></a>devtools</h3><p>因为 zustand 是 redux 系的状态管理库，所以 zustand 可以直接使用 redux 的调试工具</p>\n<div class=\"language-javascript\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">javascript</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #C792EA\">const</span><span style=\"color: #BABED8\"> store </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">create</span><span style=\"color: #BABED8\">(</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">  </span><span style=\"color: #82AAFF\">devtools</span><span style=\"color: #BABED8\">(</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF\">()</span><span style=\"color: #C792EA\">=&gt;</span><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">      </span><span style=\"color: #89DDFF\">...</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    </span><span style=\"color: #89DDFF\">&#125;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">  )</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">)</span></span>\n<span class=\"line\"></span></code></pre></div><h3 id=\"immer\"><a href=\"#immer\" class=\"headerlink\" title=\"immer\"></a>immer</h3><p>zustand 中的 set 是一个纯函数，所以 state 是 immutable，当我们需要修改乔迁套很深的对象时需要大量使用对象解构，这样的写法非常麻烦。我们可以使用中间件 immer 来简化写法。<br>首先 immer 并没有内置在 zustand 中，需要手动下载</p>\n<div class=\"language-txt\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">txt</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #babed8\">pnpm i immer</span></span></code></pre></div><p>使用方式：</p>\n<div class=\"language-javascript\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">javascript</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #C792EA\">const</span><span style=\"color: #BABED8\"> store </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">create</span><span style=\"color: #BABED8\">(</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">  </span><span style=\"color: #82AAFF\">immer</span><span style=\"color: #BABED8\">(</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8; font-style: italic\">set</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C792EA\">=&gt;</span><span style=\"color: #BABED8\"> (</span><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #F07178\">number</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">      </span><span style=\"color: #F07178\">mathTeacher</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #F07178\">man</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">,</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #F07178\">woman</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">,</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">      </span><span style=\"color: #89DDFF\">&#125;,</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">      </span><span style=\"color: #F07178\">EnglishTeacher</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">,</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF\">&#125;,</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #82AAFF\">addMathManTeacher</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">()</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C792EA\">=&gt;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">      </span><span style=\"color: #82AAFF\">set</span><span style=\"color: #F07178\">(</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8; font-style: italic\">state</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #F07178\"> </span><span style=\"color: #C792EA\">=&gt;</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">        </span><span style=\"color: #BABED8\">state</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">number</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">mathTeacher</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">man</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">+=</span><span style=\"color: #F07178\"> </span><span style=\"color: #F78C6C\">1</span><span style=\"color: #89DDFF\">;</span><span style=\"color: #F07178\"> </span><span style=\"color: #676E95; font-style: italic\">//我们可以直接修改对象的属性</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">      </span><span style=\"color: #89DDFF\">&#125;</span><span style=\"color: #F07178\">)</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    </span><span style=\"color: #89DDFF\">&#125;,</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">  </span><span style=\"color: #89DDFF\">&#125;</span><span style=\"color: #BABED8\">))</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">)</span><span style=\"color: #89DDFF\">;</span></span></code></pre></div><h3 id=\"persist\"><a href=\"#persist\" class=\"headerlink\" title=\"persist\"></a>persist</h3><p>这个中间件用于持久化仓库里的值，即使页面刷新也不会丢失，</p>\n<div class=\"language-javascript\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">javascript</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #C792EA\">const</span><span style=\"color: #BABED8\"> store </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">create</span><span style=\"color: #BABED8\">(</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">  </span><span style=\"color: #82AAFF\">persist</span><span style=\"color: #BABED8\">(</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF\">()</span><span style=\"color: #C792EA\">=&gt;</span><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">      </span><span style=\"color: #89DDFF\">...</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    </span><span style=\"color: #89DDFF\">&#125;,</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">      </span><span style=\"color: #F07178\">name</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">xxx store</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #676E95; font-style: italic\">//必选</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">      </span><span style=\"color: #F07178\">storage</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #82AAFF\">createJSONStorage</span><span style=\"color: #BABED8\">(</span><span style=\"color: #89DDFF\">()</span><span style=\"color: #C792EA\">=&gt;</span><span style=\"color: #BABED8\">sessionStorage) </span><span style=\"color: #676E95; font-style: italic\">//用于选择存储方式</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF\">&#125;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">  )</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">)</span></span></code></pre></div><p>还有一些细节配置如：选择（要&#x2F;不要）保存的值，保存成功后触发的回调，可以参考<a href=\"https://docs.pmnd.rs/zustand/integrations/persisting-store-data#migrate\">这篇文章</a></p>\n<h2 id=\"第三方库\"><a href=\"#第三方库\" class=\"headerlink\" title=\"第三方库\"></a>第三方库</h2><p>zustand 的社区非常活跃有一些第三方的中间件可以实现更多功能，如计算属性等等，官方推荐的第三方库可以参考<a href=\"https://docs.pmnd.rs/zustand/integrations/third-party-libraries\">这篇文章</a></p>\n<h2 id=\"异步获取数据\"><a href=\"#异步获取数据\" class=\"headerlink\" title=\"异步获取数据\"></a>异步获取数据</h2><p>zustand 原生支持异步获取数据，不用想 redux 那样使用 thunk 中间件加重开发者心智，直接用 async 和 await 修改数据即可</p>\n<div class=\"language-javascript\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">javascript</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #C792EA\">const</span><span style=\"color: #BABED8\"> useStore </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">create</span><span style=\"color: #89DDFF\">&lt;</span><span style=\"color: #FFCB6B\">IAsync</span><span style=\"color: #89DDFF\">&gt;</span><span style=\"color: #BABED8\">()(</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8; font-style: italic\">set</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C792EA\">=&gt;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">  </span><span style=\"color: #89DDFF; font-style: italic\">return</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    id</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">-</span><span style=\"color: #F78C6C\">1</span><span style=\"color: #89DDFF\">,</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    </span><span style=\"color: #82AAFF\">getId</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #F07178\"> </span><span style=\"color: #C792EA\">async</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">()</span><span style=\"color: #F07178\"> </span><span style=\"color: #C792EA\">=&gt;</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">      </span><span style=\"color: #676E95; font-style: italic\">// eslint-disable-next-line @typescript-eslint/no-explicit-any</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">      </span><span style=\"color: #C792EA\">const</span><span style=\"color: #F07178\"> </span><span style=\"color: #BABED8\">res</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #FFCB6B\">any</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF; font-style: italic\">await</span><span style=\"color: #F07178\"> </span><span style=\"color: #82AAFF\">fetch</span><span style=\"color: #F07178\">(</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">/api/test/</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #F07178\">)</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">      </span><span style=\"color: #C792EA\">const</span><span style=\"color: #F07178\"> </span><span style=\"color: #BABED8\">newId</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF; font-style: italic\">await</span><span style=\"color: #F07178\"> </span><span style=\"color: #BABED8\">res</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">json</span><span style=\"color: #F07178\">()</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">      </span><span style=\"color: #82AAFF\">set</span><span style=\"color: #F07178\">(</span><span style=\"color: #89DDFF\">&#123;</span><span style=\"color: #F07178\"> id</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #F07178\"> </span><span style=\"color: #BABED8\">newId</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">id</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">&#125;</span><span style=\"color: #F07178\">)</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    </span><span style=\"color: #89DDFF\">&#125;,</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">  </span><span style=\"color: #89DDFF\">&#125;;</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">&#125;</span><span style=\"color: #BABED8\">)</span><span style=\"color: #89DDFF\">;</span></span></code></pre></div><p>你甚至可以结合 react query 等第三方库使用，eg：</p>\n<div class=\"language-javascript\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">javascript</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #C792EA\">const</span><span style=\"color: #BABED8\"> useFilterStore </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">create</span><span style=\"color: #BABED8\">(</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8; font-style: italic\">set</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C792EA\">=&gt;</span><span style=\"color: #BABED8\"> (</span><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">  </span><span style=\"color: #F07178\">queryArr</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #BABED8\"> []</span><span style=\"color: #89DDFF\">,</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">  </span><span style=\"color: #82AAFF\">addFilter</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8; font-style: italic\">filter</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C792EA\">=&gt;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #82AAFF\">set</span><span style=\"color: #BABED8\">(</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8; font-style: italic\">state</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C792EA\">=&gt;</span><span style=\"color: #BABED8\"> (</span><span style=\"color: #89DDFF\">&#123;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F07178\">applied</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #BABED8\"> [</span><span style=\"color: #89DDFF\">...</span><span style=\"color: #BABED8\">state</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">applied</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> filter] </span><span style=\"color: #89DDFF\">&#125;</span><span style=\"color: #BABED8\">))</span><span style=\"color: #89DDFF\">,</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">&#125;</span><span style=\"color: #BABED8\">))</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">export</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C792EA\">const</span><span style=\"color: #BABED8\"> useAppliedFilters </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">()</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C792EA\">=&gt;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">  </span><span style=\"color: #82AAFF\">useFilterStore</span><span style=\"color: #BABED8\">(</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8; font-style: italic\">state</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C792EA\">=&gt;</span><span style=\"color: #BABED8\"> state</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">queryArray)</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">export</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C792EA\">const</span><span style=\"color: #BABED8\"> useFilteredTodos </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">()</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C792EA\">=&gt;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">  </span><span style=\"color: #C792EA\">const</span><span style=\"color: #F07178\"> </span><span style=\"color: #BABED8\">filters</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #F07178\"> </span><span style=\"color: #82AAFF\">useAppliedFilters</span><span style=\"color: #F07178\">()</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">  </span><span style=\"color: #89DDFF; font-style: italic\">return</span><span style=\"color: #F07178\"> </span><span style=\"color: #82AAFF\">useQuery</span><span style=\"color: #F07178\">(</span><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    queryKey</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #F07178\"> [</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">todos</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #F07178\"> </span><span style=\"color: #BABED8\">filters</span><span style=\"color: #F07178\">]</span><span style=\"color: #89DDFF\">,</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    </span><span style=\"color: #82AAFF\">queryFn</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">()</span><span style=\"color: #F07178\"> </span><span style=\"color: #C792EA\">=&gt;</span><span style=\"color: #F07178\"> </span><span style=\"color: #82AAFF\">getTodos</span><span style=\"color: #F07178\">(</span><span style=\"color: #BABED8\">filters</span><span style=\"color: #F07178\">)</span><span style=\"color: #89DDFF\">,</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">  </span><span style=\"color: #89DDFF\">&#125;</span><span style=\"color: #F07178\">)</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">&#125;;</span></span></code></pre></div><h2 id=\"getState-和-setState\"><a href=\"#getState-和-setState\" class=\"headerlink\" title=\"getState 和 setState\"></a>getState 和 setState</h2><p>你可以通过 getState 和 setState 这两个函数在 store 外面获取 store 的属性和修改 store 的属性。这样你可以在函数组件中定义修改 store 的函数，也可以在一个 store 中获取或修改另一个 store 的属性，还可以改变消费 store 的方式。</p>\n<p>跨 store 获取数据，eg：</p>\n<div class=\"language-javascript\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">javascript</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">export</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C792EA\">const</span><span style=\"color: #BABED8\"> useBStore </span><span style=\"color: #89DDFF\">=</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">  create </span><span style=\"color: #89DDFF\">&lt;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">  IBStore </span><span style=\"color: #89DDFF\">&gt;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">  (</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8; font-style: italic\">set</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #BABED8; font-style: italic\">get</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C792EA\">=&gt;</span><span style=\"color: #BABED8\"> (</span><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #F07178\">B</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">,</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #82AAFF\">addB</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">()</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C792EA\">=&gt;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">      </span><span style=\"color: #82AAFF\">set</span><span style=\"color: #F07178\">(</span><span style=\"color: #89DDFF\">&#123;</span><span style=\"color: #F07178\"> B</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">++</span><span style=\"color: #82AAFF\">get</span><span style=\"color: #F07178\">()</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">B</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">&#125;</span><span style=\"color: #F07178\">)</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    </span><span style=\"color: #89DDFF\">&#125;,</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #82AAFF\">getSum</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">()</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C792EA\">=&gt;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">      </span><span style=\"color: #89DDFF; font-style: italic\">return</span><span style=\"color: #F07178\"> </span><span style=\"color: #82AAFF\">get</span><span style=\"color: #F07178\">()</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">B</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">+</span><span style=\"color: #F07178\"> </span><span style=\"color: #BABED8\">useAStore</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">getState</span><span style=\"color: #F07178\">()</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">A</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    </span><span style=\"color: #89DDFF\">&#125;,</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">  </span><span style=\"color: #89DDFF\">&#125;</span><span style=\"color: #BABED8\">))</span><span style=\"color: #89DDFF\">;</span></span></code></pre></div><p>在store修改store属性的eg：</p>\n<div class=\"language-javascript\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">javascript</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">export</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C792EA\">const</span><span style=\"color: #BABED8\"> addA </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">()</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C792EA\">=&gt;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">  </span><span style=\"color: #BABED8\">useAStore</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">setState</span><span style=\"color: #F07178\">(</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8; font-style: italic\">state</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #F07178\"> </span><span style=\"color: #C792EA\">=&gt;</span><span style=\"color: #F07178\"> (</span><span style=\"color: #89DDFF\">&#123;</span><span style=\"color: #F07178\"> A</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">++</span><span style=\"color: #BABED8\">state</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">A</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">&#125;</span><span style=\"color: #F07178\">))</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">&#125;;</span></span></code></pre></div><p>通过这种方式定义函数的话，引入函数就是直接从ts文件中引入，而不是用hook的方式引入。</p>\n","text":"为什么要使用 zustand 写法比较简便，你甚至不需要根组件外面包裹一层东西，足够轻量（核心代码只有 1kb）。 写法大部分（小部分写法我感觉也很逆天）比较符...","permalink":"/post/zustand","photos":[],"count_time":{"symbolsCount":"5.4k","symbolsTime":"5 mins."},"categories":[],"tags":[],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E4%BD%BF%E7%94%A8-zustand\"><span class=\"toc-text\">为什么要使用 zustand</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%88%9D%E5%A7%8B%E5%8C%96%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95-store\"><span class=\"toc-text\">初始化一个简单 store</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%B6%88%E8%B4%B9-store\"><span class=\"toc-text\">消费 store</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#useshallow\"><span class=\"toc-text\">useshallow</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E4%B8%AD%E9%97%B4%E4%BB%B6\"><span class=\"toc-text\">中间件</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#devtools\"><span class=\"toc-text\">devtools</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#immer\"><span class=\"toc-text\">immer</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#persist\"><span class=\"toc-text\">persist</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93\"><span class=\"toc-text\">第三方库</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%BC%82%E6%AD%A5%E8%8E%B7%E5%8F%96%E6%95%B0%E6%8D%AE\"><span class=\"toc-text\">异步获取数据</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#getState-%E5%92%8C-setState\"><span class=\"toc-text\">getState 和 setState</span></a></li></ol>","author":{"name":"CeazzZY","slug":"blog-author","avatar":"","link":"/","description":"我是","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"hidden":false,"prev_post":{},"next_post":{}}